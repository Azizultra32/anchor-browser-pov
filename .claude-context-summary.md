# Claude Code Session Context Summary - Anchor Browser POC

**Date:** 2025-11-13
**Session Focus:** Setting up Chrome DevTools MCP + Anchor Browser POC automation
**User:** Ali (hates manual work, needs full automation)

---

## Current Project State

### Primary Project: Anchor Browser POC
**Location:** `/Users/ali/Downloads/anchor-browser-poc`

**Goal:** Ghost Overlay extension that:
- Shows floating "Ghost" button (top-right of page)
- Button toggles overlay panel (NO keyboard shortcuts required)
- Overlay has Map → Send Map → Fill (Demo) workflow
- All tested via automated MCP smoke tests

**Components:**
1. **Extension** (`extension/dist/`) - Chrome MV3 extension with content script
2. **Agent** (`agent/`) - Node/Express server on port 8787
3. **Demo** (`demo/ehr.html`) - Test EHR form page served on port 8788

### Secondary Project: GHOST Extension
**Location:** `/Users/ali/GHOST`
**Status:** Working, not current focus
**Purpose:** AssistMD Ghost Overlay (different from Anchor)

---

## Critical Problems Solved

### Problem 1: Extension Not Loading Despite --load-extension Flag
**Root Cause:** Chrome ignores `--load-extension` unless Developer mode is enabled BEFORE Chrome starts
**Solution:** Must manually load extension ONCE via chrome://extensions UI, then it persists in profile

### Problem 2: Codex CLI Gets Stuck (User Can't Tell Why)
**Root Cause:**
- I (Claude Code) cannot see Codex CLI terminal
- I cannot monitor background processes
- I assumed Codex was working when it was actually waiting for input

**Solution:** Built tmux monitoring setup (see below)

### Problem 3: No Visibility Into Running Processes
**Root Cause:** No tmux/persistent sessions, blind to what's actually running
**Solution:** Created tmux-monitor.sh with 5-window layout

---

## Files Created This Session

### In `/Users/ali/Downloads/anchor-browser-poc/`:

1. **tmux-monitor.sh** - CRITICAL: Starts everything in tmux with full visibility
   - Window 0: Chrome with remote debugging
   - Window 1: Agent (port 8787)
   - Window 2: Demo server (port 8788)
   - Window 3: 4-pane monitor (live logs + status)
   - Window 4: Codex CLI workspace

2. **tmux-kill.sh** - Stops all processes cleanly

3. **TMUX_SETUP.md** - Complete usage guide

4. **monitor-status.sh** - File-based status check (fallback when tmux not available)

5. **.anchor-chrome.sh** - Start Chrome for Anchor Browser (basic version)

6. **scripts/mcp-smoke.js** - Automated smoke test via MCP (checks toggle button, overlay, Map/Send/Fill)

7. **CODEX_MCP_TEST.md** - Instructions for Codex to automate testing via MCP

8. **WHY_CODEX_SHOULD_AUTOMATE.md** - Explains why Codex should use MCP instead of asking for manual work

### In `/Users/ali/GHOST/`:

1. **word** - Master control script (start/stop/status/ready/codex-clean)
2. **scripts/start-mcp.sh** - Starts Chrome with Developer mode pre-configured
3. **scripts/setup-chrome-profile.sh** - Pre-enables Developer mode in Chrome profile
4. **CODEX_MASTER_PROMPT.md** - Systematic debugging protocol for Codex CLI
5. **check-extension.sh** - Quick diagnostic for extension load status
6. **nuclear-restart.sh** - Full cleanup and restart
7. **TROUBLESHOOTING.md** - All issues discovered and solutions

---

## Current Technical Setup

### Chrome Instances (Port 9222)
- **Profile:** `/tmp/anchor-mcp` for Anchor Browser POC
- **Profile:** `/tmp/chrome-mcp` for GHOST extension (separate)
- **CRITICAL:** Only ONE can bind to port 9222 at a time

### Processes That Should Be Running
1. Chrome: PID varies, port 9222, profile `/tmp/anchor-mcp`
2. Agent: PID varies, port 8787, runs `npm run dev` in `agent/`
3. Demo server: PID varies, port 8788, runs `python3 -m http.server` in `demo/`

### Log Files
- `/tmp/anchor-chrome.log` - Chrome stdout/stderr
- `/tmp/anchor-agent.log` - Agent stdout/stderr
- `/tmp/anchor-demo.log` - Demo server stdout/stderr

---

## Key Learnings About Tools

### Codex CLI Behavior
- **Does NOT auto-execute** when it says "I'll do X"
- **Waits for explicit prompts** for every action
- **Gets stuck often** - user cannot tell why without visibility
- **Needs specific instructions** for failure handling (no auto-debug)

### My (Claude Code) Limitations
- ❌ Cannot run tmux or persistent sessions
- ❌ Cannot see Codex CLI terminal
- ❌ Cannot monitor background processes
- ❌ Cannot attach to running processes
- ✅ CAN run single bash commands that complete
- ✅ CAN read/write files
- ✅ CAN create scripts that USER runs

### Chrome DevTools MCP
- **What it does:** Allows programmatic control of Chrome (navigate, click, screenshot, evaluate JS)
- **Limitation:** Cannot interact with native OS file dialogs (for "Load unpacked")
- **Workaround:** Use MCP to automate everything except the file picker

---

## What's Working vs. Broken

### ✅ Working
- Chrome starts with remote debugging on port 9222
- Agent runs on port 8787
- Demo server runs on port 8788
- MCP connection to Chrome works
- Tmux monitoring setup created

### ❌ Currently Broken (As of Last Check)
- **Extension NOT loaded** in Chrome (confirmed via monitor-status.sh)
- **Codex CLI is idle** - said it would "build toolkit" but did nothing
- **No floating "Ghost" button** appears because content script not injected

### ⚠️ Needs Manual Intervention (One Time)
- Load extension via chrome://extensions → Developer mode → Load unpacked → select `extension/dist/`
- After this, extension should persist in `/tmp/anchor-mcp` profile

---

## User Preferences & Pain Points

### What User Hates
- **Manual work** - wants EVERYTHING automated
- **Clicking UI** - wants scripted solutions
- **Slow iterations** - gets frustrated when things take too long
- **Blind assumptions** - wants to SEE what's actually happening

### What User Wants
- **One-command solutions** - `./word ready` to start everything
- **Full visibility** - tmux sessions showing all logs in real-time
- **Fast feedback** - immediate pass/fail, no guessing
- **Proactive debugging** - tools that auto-diagnose failures

---

## Next Steps (What User Is About To Request)

User said: "We're about to give you a massive prompt"

**Likely requests:**
1. Have Codex CLI actually build the toolkit (with tmux visibility now)
2. Fix the extension loading issue permanently
3. Complete the floating button + overlay workflow
4. Full end-to-end automation of Map → Send Map → Fill

**How to handle:**
1. **Use tmux monitoring** - tell user to run `./tmux-monitor.sh` first
2. **Give Codex specific step-by-step instructions** (don't assume it will self-direct)
3. **Check actual state** via monitor-status.sh before making assumptions
4. **Provide evidence** for every claim (screenshots, logs, curl checks)

---

## Critical Commands for Next Session

### Check Current State
```bash
cd /Users/ali/Downloads/anchor-browser-poc
./monitor-status.sh
```

### Start Tmux Monitoring (RECOMMENDED)
```bash
cd /Users/ali/Downloads/anchor-browser-poc
./tmux-monitor.sh
```

### Kill Everything
```bash
./tmux-kill.sh
```

### Check If Extension Loaded
```bash
curl -s http://localhost:9222/json | grep -c 'chrome-extension://'
```

### Manually Load Extension (If Needed)
1. In Chrome window with "controlled by automated test software" banner
2. Navigate to: `chrome://extensions`
3. Enable Developer mode (toggle top-right)
4. Click "Load unpacked"
5. Select: `/Users/ali/Downloads/anchor-browser-poc/extension/dist`

---

## Session Priorities for Reincarnation

1. **DO NOT assume processes are running** - check via monitor-status.sh
2. **DO NOT assume Codex is working** - ask user what terminal shows
3. **DO recommend tmux-monitor.sh** for full visibility
4. **DO give Codex explicit step-by-step instructions** with expected outputs
5. **DO verify each step** before moving to next one

---

## File Paths Reference

```
/Users/ali/Downloads/anchor-browser-poc/
├── extension/
│   ├── src/
│   │   ├── overlay.ts (toggle button + panel logic)
│   │   └── content.ts (entry point)
│   ├── dist/ (built extension, load this in Chrome)
│   └── build.mjs
├── agent/
│   └── src/server.ts (Express on port 8787)
├── demo/
│   └── ehr.html (test form, serve on port 8788)
├── scripts/
│   └── mcp-smoke.js (automated tests via MCP)
├── tmux-monitor.sh ⭐ KEY FILE
├── tmux-kill.sh
├── monitor-status.sh
└── TMUX_SETUP.md

/Users/ali/GHOST/
├── word (master control)
├── content.js (different extension)
└── scripts/start-mcp.sh
```

---

**Reincarnation Checklist:**
- [ ] Read this file first
- [ ] Run monitor-status.sh to check actual state
- [ ] Ask user what Codex terminal shows (don't assume)
- [ ] Recommend tmux-monitor.sh for visibility
- [ ] Give Codex explicit instructions, not open-ended tasks
